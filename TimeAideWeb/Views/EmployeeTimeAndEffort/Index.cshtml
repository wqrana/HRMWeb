
@{
    ViewBag.Title = "Time and Effort";
    Layout = "~/Views/Shared/_Layout.cshtml";

    @Html.Hidden("TAESEndDays", (string)ViewBag.TAEEndDD)
}
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js" integrity="sha512-T/tUfKSV1bihCnd+MxKD0Hm1uBBroVYBOYSk1knyvQ9VyZJpc/ALb4P0r6ubwVPSGB2GvjeoMAJJImBG12TiaQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css" integrity="sha512-mSYUmp1HYZDFaVKK//63EcZq4iFWFjxSL+Z3T/aCt4IO9Cejm03q3NKKYN6pFQzY0SBOr8h+eCIAZHPXcpZaNw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

@*<link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />*@
<!-- Page Header -->
<div class="page-header">
    <div class="row align-items-center">
        <div class="col-sm-12">
            <h3 class="page-title">Time and Effort</h3>
            <ul class="breadcrumb">
                <li class="breadcrumb-item">Attendance</li>
                <li class="breadcrumb-item active">Time and Effort</li>

            </ul>
            <div class="alert" style="display:none;" id="applicantIndexPageAlert">
                <a href="javascript:void(0)" class="close" id="alertDismiss">&times;</a>
                <strong>Alert!</strong><span></span>
            </div>
        </div>

    </div>
</div>
@{Html.RenderAction("GetTimeAEffortFilters", "EmployeeTimeAndEffort");}

<div class="row pb-0 mb-0">
    <div class="col-sm-10">
        <button class="btn btn-success btn-sm" onclick="javascript:allTAEApproval('1');"><i class="fa fa-check fa-lg"></i> Approve All</button>
        <button class="btn btn-danger btn-sm" onclick="javascript:allTAEApproval('0');"><i class="fa fa-close fa-lg"></i> Unapprove All</button>
    </div>
    <div class="col-sm-2 pr-0">
        <div class="col-auto float-right ml-auto pr-0">
            <div class="btn-group btn-group-sm pb-1">
                @*<button class="btn btn-white">PDF</button>*@
                <button class="btn btn-white" onclick="javascript:runLocalReport(0)"><i class="fa fa-print fa-lg"></i> Print</button>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-6 pt-2"><h5>Total Record(s):<span id="spanTotalRec" class="pl-1">0</span></h5></div>
    <div class="col-md-6">
        <div style="text-align:right;">
            <label style="text-align:left;">
                Search:<input id="TAESearchTxt" style="display:inline-block; width:auto; margin-left:0.5rem;" type="text" class="form-control form-control-sm" placeholder="">
            </label>
        </div>
    </div>
</div>
<div style="padding:5px; padding-top:0px;">
    <div style="font-size: 90%;">
        <div class="form-group row mb-0">
            <div id="divLoadingTimeAndEffort" class="align-content-md-center">
                <img src="~/Content/Themes/assets/img/ajax-loading.gif" width="24" height="24" />
            </div>
            <div class="panel panel-default" style="width:100%;margin-left:5px">
                <div class="panel-heading" style="padding-left:10px">
                    Time And Effort

                </div>
                <div class="panel-body">
                    <div id="divTimeAndEffort" style="max-height:600px; overflow-y:auto">
                        Fetch data
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="divAdhocPopup">

</div>
@*<script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>*@
<script>
    //JS for Applicant main page
    var alertID = null;
    $(document).ready(function () {
        debugger;
        //Default User List on list view
        $("#divLoadingTimeAndEffort").hide();

        //$('#pickDateTime').datetimepicker({
        //    format: "DD/MM/YYYY hh:mm A"
        //});
               
        //Filter table
        $("#TAESearchTxt").on("keyup", function () {
            debugger;
            var filterTable = "tblTimeAEffort";

            var value = $(this).val().toLowerCase();
            $("#" + filterTable + ">tbody>tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    });

    function getTimeAndEffort() {
        $("#divLoadingTimeAndEffort").show();
        debugger;
        var filterObject = new Object();
        $("#TAESearchTxt").val("");
        filterObject.ScheduleDate = $('#EffortDte').val();
        filterObject.EmployeeId = $('#EmployeeId').val();
        filterObject.EmployeeName = $('#EmployeeName').val();
        filterObject.DepartmentId = $('#DepartmentId').val();
        filterObject.SubDepartmentId = $('#SubDepartmentId').val();
        filterObject.EmployeeTYpeId = $('#EmployeeTypeId').val();
        filterObject.TAEApprovalTypeId = $('#SupApprovalTypeId').val();
        filterObject.TAEEmpApprovalTypeId = $('#EmpApprovalTypeId').val();
        $.ajax({
            type: "POST",
            url: '/EmployeeTimeAndEffort/GetTimeAndEffort',
            data: JSON.stringify(filterObject),

            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                $("#divTimeAndEffort").html(data);

                $("#divLoadingTimeAndEffort").hide();
            },
            error: function () {
                // displayWarningMessage(data.ErrorMessage);
            }
        });
    }
    function individualTAEApproval(id) {
        var dataObject = new Object();
        dataObject.TAEIds = id;
        dataObject.ActionType = "I";
        openApprovalPopup(dataObject);
    }
    function allTAEApproval(approvalTypeId) {

        debugger;
        var dataObject = new Object();
        dataObject.TAEIds = $("#TAEIds").val();
        dataObject.ActionType = "A";
        dataObject.ApprovalTypeId = approvalTypeId;
        openApprovalPopup(dataObject);
    }
    function openApprovalPopup(dataObj) {


        $.ajax({
            type: "POST",
            url: '/EmployeeTimeAndEffort/TimeAndEffortApprovalPopup',
            data: JSON.stringify(dataObj),

            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                $("#divAdhocPopup").html(data);
                $("#TAEApproval_modal").modal("show");

            },
            error: function () {
                // displayWarningMessage(data.ErrorMessage);
            }
        });
    }
    function runLocalReport() {
        debugger;
        var dataObj = new Object();
        dataObj.ReportId = 31;
        dataObj.CriteriaType = 2; // 2 is used to run local report
        dataObj.EmployeeSelectionIds = $('#TAEIds').val();
        $.ajax({
            type: "POST",
            url: "/Reports/AdhocReportPopup",
            data: JSON.stringify(dataObj),
            contentType: "application/json; charset=utf-8",
            // dataType: "json",
            success: function (data) {
                debugger;
                //console.log(data);
                $("#divAdhocReportPopup").html(data);
                // setTimeout(function () { $('#divLoadingReport').hide(); }, 3000);
                $("#AdhocReportPopup_modal").modal('show');
            },
            error: function (request, status, error) {
                alert('Error in in runing  report data');
                return false;
            }
        });
    }


</script>

