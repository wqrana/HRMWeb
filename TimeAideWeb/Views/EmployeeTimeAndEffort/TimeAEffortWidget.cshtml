@model  IEnumerable<TimeAide.Web.Models.EmployeeTimeAndEffort>
@{
    var effortMonth = ViewBag.EffortMonth;
    var statusCode = ViewBag.StatusCode;

}
<h4>
    @effortMonth
</h4>
<div>
    @if (statusCode == "NotFound" || statusCode == "NotApproved")
    {
        <h4 class="text-warning">Time and Effort data is not available.</h4>
    }    
    else
    {
        var empTAERecord = Model.FirstOrDefault();
        var empStsCss = "bg-inverse-success";
        var empSts = "Approved";
        var supStsCss = "bg-inverse-success";
        var supSts = "Approved";
        if (!empTAERecord.IsEmployeeApproved)
        {
            empStsCss = "bg-inverse-danger";
            empSts = "Unapproved";

        }
        if (!empTAERecord.IsSupervisorApproved)
        {
            supStsCss = "bg-inverse-danger";
            supSts = "Unapproved";
        }
        var effortTypeList = Model.Select(s => s.CompensationName).Distinct();
        var totalEffortHrs = Model.Sum(s => s.EffortHours);
        <div>
            <span class="font-weight-lighter pull-left">Supervisor:<span class="badge @supStsCss">@supSts</span></span>
            <span class="font-weight-lighter pull-right">Employee:<span class="badge @empStsCss">@empSts</span></span>
           
        </div>
        <br />
        <div class="div-responsive pt-2">
            <table class="table table-striped table-condensed table-sm" style="font-family: 'Times New Roman', Times, serif; font-size: medium; ">

                <tbody>
                    @foreach (var effortType in effortTypeList)
                    {
                        var totalEffortTypeHrs = Model.Where(w => w.CompensationName == effortType).Select(s => s.EffortHours).Sum();
                        decimal effortTypePct = 0;
                        if (totalEffortTypeHrs>0 && totalEffortHrs > 0)
                        {
                            effortTypePct= Math.Round(totalEffortTypeHrs / totalEffortHrs * 100, 2);
                        }
                        <tr>
                        <td>
                            @effortType
                        </td>
                        <td>
                            @totalEffortTypeHrs
                            <span class="pull-right">@effortTypePct%</span>
                        </td>
                    </tr>
                    }
                   
                </tbody>
                <tfoot>
                    <tr>
                        @{ 
                            var totalEPct = 0;
                            if (totalEffortHrs > 0)
                            {
                                totalEPct = 100;
                            }
                        }
                        <th>Total</th>
                        <th>@totalEffortHrs <span class="pull-right">@totalEPct%</span></th>
                    </tr>
                </tfoot>
            </table>
        </div>
    }
</div>