@model TimeAide.Web.ViewModel.ReportViewModel
<style>

    iframe {
        /*width: 100%;*/
        padding-left: 10px;
        padding-top: 5px;
        max-height: 600px;
    }

    .printView {
        /*border: .5px #eaeaea solid;*/
        min-height: 550px;
        background-color: #FFFFFF;
        /* margin-left: 2%;*/
    }
    .modal-dialog {
         width: 1000px;
         max-width: 1000px !important; 
    }
</style>
<div id="JobCertificatePopup_modal" class="modal custom-modal">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="mt-2 p-2 mt-0">
                <div class="alert alert-primary" style="text-align:center;background-color: #00c5fb;border: 1px solid #00c5fb;">
                    <h4 style="display: inline;">Job Certificate</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <hr>
            </div>
            <div class="modal-body pt-0">
                <div class="row filter-row">
                    @{

                        var isDisabled = Model.CriteriaType == 1 ? "" : "disabled";

                    }
                    <div class="col-sm-4 col-md-2 pr-0">
                        <div class="form-group form-focus select-focus">
                            <input id="EmployeeId" type="number" value="@Model.EmployeeSelectionIds" class="form-control floating" disabled>
                            <label class="focus-label">Employee ID</label>
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-3 pr-0 pl-1">
                        @*<div class="form-group form-focus select-focus">
                                @Html.Hidden("SigneeId", Model.SuperviorId)
                                <input id="SigneeName" type="text" value="@Model.ActionTypeSelectionIds" class="form-control floating" disabled>

                                <label class="focus-label">Signee Name</label>
                            </div>*@
                        <div class="form-group form-focus select-focus">
                            @*@Html.Hidden("SigneeId", Model.SuperviorId)*@
                            @Html.DropDownList("SigneeId", (SelectList)@Model.JobCertificationSigneeList, "Please Select", new { @class = "select floating form-control" })

                            <label class="focus-label">Signee Name</label>
                        </div>
                    </div>
                    <div class="col-sm-4 col-md-2 pr-0 pl-1">
                        <div class="form-group form-focus select-focus">
                            <input id="EffectiveDate" type="datetime" class="form-control select floating" value="@DateTime.Today" @isDisabled>
                            <label class="focus-label">Effective-Date</label>
                        </div>
                    </div>

                    <div class="col-sm-6 col-md-3 pr-0 pl-1">
                        <div class="form-group form-focus select-focus">
                            @Html.DropDownList("JobCertificationTemplateId", (SelectList)@Model.JobCertificationTemplateList, "Please Select", new { @class = "select floating form-control" })
                            @*@Html.DropDownList("EmployeeStatusId", null, "All", new { @class = "select floating" })*@
                            <label class="focus-label">Template</label>
                        </div>
                    </div>
                    <div class="col-sm-4 col-md-2 pl-1 pr-0">
                        <a href="javascript:showJobCertificate();" class="btn btn-success"> Generate </a>
                    </div>
                </div>
                @*<div class="row align-items-center">
                        <div class="col">
                            <h4 class="payslip-title"></h4>
                        </div>
                        <div class="col-auto float-right ml-auto">
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-white" onclick='javascript:printJobCertificate()'><i class="fa fa-print fa-lg"></i> Print</button>
                            </div>
                        </div>
                    </div>*@
                <div id="divLoadingReport" class="align-content-md-center">
                    <img src="~/Content/Themes/assets/img/ajax-loading.gif" width="18" height="18" />
                </div>
                <div id="divJobCertView" class="printView pl-2 pt-2 pr-2" style="max-width:950px;">
                    @Html.TextArea("jobCertificateView", new {
                             rows = "5", style = "resize:none;width:700px;", @class = "form-control jobCert-PrintPreview"
                             })
                </div>

            </div>

            <div class="submit-section pb-2 mt-0">
                <button id="btnCancel" class="btn btn-primary  submit-btn" data-dismiss="modal" aria-label="Close">Close</button>
            </div>

        </div>
    </div>
</div>
@*<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>*@
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.min.js"></script>
<link href="https://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css" rel="stylesheet">
<script src="~/Scripts/jquery-ui.js"></script>
<link href="~/Content/Themes/assets/plugins/summernote/dist/summernote.css" rel="stylesheet" />
<script src="~/Content/Themes/assets/plugins/summernote/dist/summernote.js"></script>
<script src="~/Content/Themes/assets/plugins/summernote/dist/summernote-ext-print.js"></script>
<script>
    $(document).ready(function () {
        debugger;
        
        //  runAdhocReport();
        initPrintPreview();
        $('#divLoadingReport').hide();
        if (@Model.CriteriaType== 2) {
            $("#JobCertificationTemplateId").prop("disabled", true);
            $("#SigneeId").prop("disabled", true);
        }
        $('input[id*=Date]').each(function () {
            $(this).datetimepicker({ format: 'MM/DD/YYYY' });

        });
    });

    function printJobCertificate() {
        var empId = $("#EmployeeId").val();
        var jobCertificateFileName = empId + "_JobCertificate.pdf";
        var options = {
        };
        var pdf = new jsPDF('p', 'pt', 'a4');
        //pdf.addHTML($("#divJobCertView"), 5, 5, options, function () {
        //    pdf.save(jobCertificateFileName);
        //});

        // source can be HTML-formatted string, or a reference
        // to an actual DOM element from which the text will be scraped.
        source = $("#divJobCertView")[0];

        // we support special element handlers. Register them with jQuery-style
        // ID selector for either ID or node name. ("#iAmID", "div", "span" etc.)
        // There is no support for any other type of selectors
        // (class, of compound) at this time.
        specialElementHandlers = {

        };
        margins = {
            top: 80,
            bottom: 60,
            left: 40,
            width: 522
        };
        // all coords and widths are in jsPDF instance's declared units
        // 'inches' in this case
        pdf.fromHTML(
            source, // HTML string or DOM elem ref.
            margins.left, // x coord
            margins.top, { // y coord
                'width': margins.width, // max width of content on PDF
                'elementHandlers': specialElementHandlers
            },

            function (dispose) {
                // dispose: object with X, Y of the last line add to the PDF
                //          this allow the insertion of new lines after html
                pdf.save(jobCertificateFileName);
            }, margins
        );

    }
   function showJobCertificate() {

      debugger;
       var dataObj = new Object();
       var reportURL = "/Reports/JobCertificatePrintView";
       //template id
       dataObj.ReportId = $("#JobCertificationTemplateId").val();
       //employeeid
       dataObj.EmployeeSelectionIds = $("#EmployeeId").val();
       //effective Date
       dataObj.FromDate = $("#EffectiveDate").val();
       //user Information ID
       dataObj.AttendanceSchId = @Model.AttendanceSchId;
       //signee id
       dataObj.SuperviorId = $("#SigneeId").val();

       var isRequiredValidated = 0;
       if (dataObj != null) {
           isRequiredValidated += dataObj.ReportId.trim().length > 0 ? 1 : 0;
           isRequiredValidated += dataObj.FromDate.trim().length > 0 ? 1 : 0;
           isRequiredValidated += dataObj.SuperviorId.trim().length > 0 ? 1 : 0;
           if (isRequiredValidated != 3) {
               showAlertAutoHide("", "Error", "Missing required field(s)");
               return;
           }
       }
       $('#divLoadingReport').show();
            $.ajax({
                type: "POST",
               // url: "/Reports/ReportView",
                url: reportURL,
                data: JSON.stringify(dataObj),
                contentType: "application/json; charset=utf-8",
                // dataType: "json",
                success: function (data) {
                    debugger;
                    //console.log(data);
                  //  $("#divJobCertView").html(data);
                  //  $("#divPrintPreview").html(data);
                    $('.jobCert-PrintPreview').summernote('code', data);
                    $('#divLoadingReport').hide();
                },
                error: function (request, status, error) {
                    alert('Error in in runing  report data');
                    return false;
                }
            });
    }
    function initPrintPreview() {
        $('.jobCert-PrintPreview').summernote({
                toolbar: [
                    ['misc', ['print']]
                ],

                height: 700, // set editor height
                minHeight: null, // set minimum height of editor
                maxHeight: null, // set maximum height of editor
                focus: false, // set focus to editable area after initializing summernote
                //  disableDragAndDrop: true

            });

        $('.jobCert-PrintPreview').summernote('disable');
        $(".note-btn").removeAttr("disabled").removeClass("disabled");
        $(".note-editable").css("background", "white");
            $('div.note-popover').css("display", "none");

    }
</script>

