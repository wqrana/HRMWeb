
@{
    ViewBag.Title = "Timesheet";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js" integrity="sha512-T/tUfKSV1bihCnd+MxKD0Hm1uBBroVYBOYSk1knyvQ9VyZJpc/ALb4P0r6ubwVPSGB2GvjeoMAJJImBG12TiaQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css" integrity="sha512-mSYUmp1HYZDFaVKK//63EcZq4iFWFjxSL+Z3T/aCt4IO9Cejm03q3NKKYN6pFQzY0SBOr8h+eCIAZHPXcpZaNw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<!-- Page Header -->
<div class="page-header">
    <div class="row align-items-center">
        <div class="col-sm-12">
            <h3 class="page-title">Self Service Timesheet</h3>

        </div>

    </div>
</div>
@Html.Hidden("selfServiceTSBeforeDD", (string)ViewBag.selfServiceTSBeforeDD)
@Html.Hidden("selfServiceTSAfterDD", (string)ViewBag.selfServiceTSAfterDD)
@Html.Hidden("userId", (int)ViewBag.userId)
@Html.Hidden("employeeId", (int)ViewBag.employeeId)

<div class="row filter-row">
    <div class="col-sm-3 col-md-3">
        <div class="form-group form-focus">
            <input id="TimesheetDte" type="text" class="form-control floating" value="@DateTime.Today.ToString("MM/dd/yyyy")">
            <label class="focus-label">Timesheet From/To Date</label>
        </div>
    </div>
    <div class="col-sm-2 col-md-2">
        <a href="javascript: getSelfServiceTimesheetDetail();" class="btn btn-success btn-block"> View Timesheet </a>
    </div>
</div>



<div style="padding:5px; padding-top:0px;">
    <div style="font-size: 90%;">
        <div class="form-group row mb-0">
            <div id="divLoadingSelfServiceSchedule" class="align-content-md-center">
                <img src="~/Content/Themes/assets/img/ajax-loading.gif" width="24" height="24" />
            </div>
            <div class="panel panel-default" style="width:100%;margin-left:5px">
                <div class="panel-heading" style="padding-left:10px">
                    Timesheet Detail

                </div>
                <div class="panel-body">
                    <div id="divSelfServiceTimesheetView">
                        View Timesheet Detail
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>



<script>
    //JS for Applicant main page
    var alertID = null;
    $(document).ready(function () {
        debugger;
        //Default User List on list view
        $("#divLoadingSelfServiceSchedule").hide();
        getSelfServiceTimesheetDetail();

        var beforVal = $("#selfServiceTSBeforeDD").val();
        var afterVal = $("#selfServiceTSAfterDD").val();
        $('#TimesheetDte').datepicker({
            //autoclose: true,

            format: 'mm/dd/yyyy',
            //startDate: beforVal,
            //endDate: afterVal
        });
        $("#btnApproveTimesheet").click(function (e) {
            approveTimesheet();
        });
    });
    function approveTimesheet() {
        var model = {
            e_id: $('#employeeId').val(),
            nWeekID: $('#hdnPayrollnWeekID').val(),
            intUserReviewed: "1"
        }

        //e.preventDefault();

        $.ajax({
            type: 'post',
            url: '/EmployeeTimesheet/ApproveEmployeeTimesheetView',
            data: JSON.stringify(model),
            contentType: 'application/json; charset=utf-8',
            dataType: "json",
            success: function (html) {
                debugger;
                toastr.success("Timesheet reviewed successfully!", "Success");
                $('#btnApproveTimeshet').prop('disabled', true);
                //add rest code here                
                $("#spanEmpReviewStatus").removeClass("text-danger").addClass("text-purple");
                $("#spanEmpReviewStatusTxt").text("Reviewed");
            },
            error: function (xhr, ajaxOptions, thrownError) {
                toastr.error("There was in error during approving timesheet!", "Error");

            }
        });
    }

    function getSelfServiceTimesheetDetail() {
        $("#divLoadingSelfServiceSchedule").show();
        debugger;
        var filterObject = new Object();
        var scheduleDte = $('#TimesheetDte').val() + " 12:00:00 AM";
        filterObject.ScheduleDate = scheduleDte;
        filterObject.EmployeeId = $("#employeeId").val();
        $.ajax({
            type: "POST",
            url: '/EmployeeTimesheet/GetSelfServiceTimesheetDetail',
            data: JSON.stringify(filterObject),

            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                /*data = data.text().replace("??:??", "<a href='#'>??:??</a>")*/
                $("#divSelfServiceTimesheetView").html(data);
                $("#divLoadingSelfServiceSchedule").hide();
            },
            error: function () {
                // displayWarningMessage(data.ErrorMessage);
            }
        });
    }
    function runLocalReport(tpwId) {
        debugger;
        var dataObj = new Object();
        dataObj.ReportId = 29; // give report id
        dataObj.CriteriaType = 2; // 2 is used to run local report
        dataObj.AttendanceSchId = tpwId;
        //dataObj.ScheduleDate = $('#ScheduleDate').val();
        dataObj.EmployeeSelectionIds = tpwId == 0 ? $('#SelectedReportWeekIds').val() : tpwId;
        $.ajax({
            type: "POST",
            url: "/Reports/AdhocReportPopup",
            data: JSON.stringify(dataObj),
            contentType: "application/json; charset=utf-8",
            // dataType: "json",
            success: function (data) {
                debugger;
                //console.log(data);
                $("#divAdhocReportPopup").html(data);
                // setTimeout(function () { $('#divLoadingReport').hide(); }, 3000);
                $("#AdhocReportPopup_modal").modal('show');
            },
            error: function (request, status, error) {
                alert('Error in in runing  report data');
                return false;
            }
        });
    }

</script>


