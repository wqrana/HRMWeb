@using TimeAide.Services.Helpers;
@using TimeAide.Common.Helpers;
@model TimeAide.Web.ViewModel.DashboardViewModel
<div id="MyDashboard_modal" class="modal custom-modal">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">

            <div class="mt-2 p-1">
                <div class="alert alert-primary" style="text-align:center;background-color: #00c5fb;border: 1px solid #00c5fb;">
                    <h4 style="display: inline;">Self Service</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <hr>
            </div>
            <div class="modal-body pt-0">

                <div class="row">
                    <div class="col-md-12">
                        <div class="welcome-box mb-2">
                            <div class="welcome-img">
                                <img alt="" src="@Model.UserProfilePicture">
                            </div>
                            <div class="welcome-det">
                                <h3>Welcome, @Html.DisplayFor(m => m.UserName)</h3>
                                @Html.HiddenFor(m => m.UserId)
                                <p>@DateTime.Now.ToString("dddd, dd MMMM yyyy")</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">

                    <div class="col-md-12 col-lg-6 col-xl-4 d-flex">
                        <div class="card flex-fill mb-2">
                            <div class="card-body pb-0">
                                <h4 class="card-title" style="margin-left:-10px;margin-right:-10px;">
                                    My Notification(s)
                                    <span class="pull-right" style="font-size:x-small;">
                                        <select id="myNotificationPeriodType">
                                            <option value="0">Today</option>
                                            <option value="1">This Week</option>
                                            <option value="2">Two Weeks</option>
                                            <option value="3">One Month</option>
                                            <option value="4" selected>Quarter</option>
                                            <option value="6">Semester</option>
                                            <option value="12">One Year</option>
                                        </select>
                                    </span>
                                </h4>
                                <div id="divLoadingMyNotificationWidget" class="align-content-md-start">
                                    <img src="~/Content/Themes/assets/img/ajax-loading.gif" width="18" height="18" />
                                </div>
                                <div id="divDashboardMyNotiRecord">

                                    <div class="statistics">
                                        <div class="row">
                                            <div class="col-md-6 col-6 text-center">
                                                <a href="">
                                                    <div class="stats-box mb-4">
                                                        <p>Notifying</p>

                                                        <h3>0</h3>

                                                    </div>
                                                </a>
                                            </div>
                                            <div class="col-md-6 col-6 text-center">
                                                <a href="">
                                                    <div class="stats-box mb-4">
                                                        <p>Expired</p>
                                                        <h3>0</h3>
                                                    </div>
                                                </a>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="progress mb-4">
                                        <div class="progress-bar bg-warning" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                                        <div class="progress-bar bg-danger" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>

                                    </div>
                                    <div>

                                        <p><i class="fa fa-dot-circle-o text-warning mr-2"></i>Notifying <span class="float-right">0</span></p>

                                        <p><i class="fa fa-dot-circle-o text-danger mr-2"></i>Expired <span class="float-right">0</span></p>

                                    </div>
                                </div>
                            </div>
                            <div class="card-footer" style="text-align:center;">
                                <a href="javascript:loadMyNotificationWidgetDetail();" class="fa fa-refresh"></a>
                            </div>
                        </div>
                    </div>

                    @*<div class="col-md-8 d-flex pl-0">
                            <div class="card card-table flex-fill mb-2">
                                <div class="card-header">
                                    <h3 class="card-title mb-0" id="notificationTypeList">My Notification(s) List</h3>
                                </div>
                                <div class="card-body">
                                    <div id="divLoadingMyNotificationList" class="align-content-md-start">
                                        <img src="~/Content/Themes/assets/img/ajax-loading.gif" width="18" height="18" />
                                    </div>
                                    <div id="divDashboardMyNotificationList" style="max-height:270px; overflow-y:auto">
                                        <div class="table-responsive">
                                            <table class="table table-nowrap custom-table mb-0">
                                                <thead>
                                                    <tr>

                                                        <th>Record Name</th>
                                                        <th>Record Type</th>
                                                        <th>Notification Date</th>
                                                        <th>Status</th>
                                                        <th>Expiry Date</th>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer">
                                    @{ var id = TimeAide.Common.Helpers.SessionHelper.LoginId; }
                                    <a href="/UserInformation/Details/@id" style="color:#007bff;">View Employee Detail</a>
                                </div>
                            </div>
                        </div>*@
                    @Html.Hidden("IsTimeAideWindowClient", SessionHelper.IsTimeAideWindowClient)
                    @if (SessionHelper.IsTimeAideWindowClient)
                    {
                        <div class="col-md-4 d-flex pl-0">

                            <div class="card flex-fill mb-2">
                                <div id="divLoadingCurrentSchedule" class="align-content-md-start">
                                    <img src="~/Content/Themes/assets/img/ajax-loading.gif" width="18" height="18" />
                                </div>

                                <div class="card-header" style="padding:15px;">
                                    <h3 class="card-title mb-0" id="">
                                        Current Schedule
                                        <span class="float-right pt-2" style="font-size:x-small;" id="spanScheduleDateRange">-</span>
                                    </h3>
                                </div>
                                <div class="card-body pb-0">

                                    <div>
                                        <p><i class="fa fa-dot-circle-o text-success mr-2"></i>Working Day(s) <span class="float-right" id="spanWorkingDays">-</span></p>

                                        <p><i class="fa fa-dot-circle-o text-info mr-2"></i>Total Hour(s) <span class="float-right" id="spanTotalHours">-</span></p>

                                    </div>

                                </div>
                                <div class="card-footer" style="text-align:center;">
                                    <a href="javascript:viewCurrentScheduleDetail(@Model.UserId);">View Schedule</a>
                                </div>

                            </div>
                        </div>
                        <div class="col-md-4 d-flex pl-0">
                            <div class="card flex-fill mb-2">
                                <div class="card-header">
                                    <h3 class="card-title mb-0" id="licensesList">Licenses</h3>
                                </div>
                                <div class="card-body p-0">
                                    <div id="divLoadingMyLicensesList" class="align-content-md-start">
                                        <img src="~/Content/Themes/assets/img/ajax-loading.gif" width="18" height="18" />
                                    </div>
                                    <div id="divDashboardMyLicensesList" style="max-height:200px; overflow-y:auto">
                                        <div class="table-responsive">
                                            <table class="table table-nowrap custom-table mb-0">
                                                <thead>
                                                    <tr>

                                                        <th>Accrual Type</th>
                                                        <th>Balances</th>
                                                        <th>SearchDate</th>

                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer" style="text-align:center;">
                                    @if (SecurityHelper.IsAvailable("EmployeeTimeOffRequest"))
                                    {
                                        <a href="javascript:viewTimeOffDetail();">View Time Off Detail</a>
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 d-flex">
                            <div class="card flex-fill mb-2">
                                <div class="card-body pb-0">
                                    <h4 class="card-title" style="margin-left:-10px;margin-right:-10px;">
                                        Pay Stub
                                        <span class="pull-right" style="font-size:x-small;">
                                            <select id="payStubBatchList">
                                                <option value="0">--------------</option>

                                            </select>
                                        </span>
                                    </h4>
                                    <div id="divLoadingPayStubWidget" class="align-content-md-start">
                                        <img src="~/Content/Themes/assets/img/ajax-loading.gif" width="18" height="18" />
                                    </div>
                                    <div id="divDashboardPayStubRecord">

                                        <div>
                                            <p>Name <span class="float-right" id="payStubBatchName">-</span></p>
                                            <p>Pay Date <span class="float-right" id="payStubPayDate">-</span></p>
                                            @* <p>Period Start <span class="float-right" id="payStubStartDate">-</span></p>
                                                <p>Period End <span class="float-right" id="payStubEndDate">-</span></p>*@
                                            <p>Pay Period <span class="float-right" id="payStubPayPeriod">-</span></p>
                                            <p>Earnings <span class="float-right" id="payStubEarning">$</span></p>
                                            <p>Deductions <span class="float-right" id="payStubDeduction">$</span></p>
                                            <p>Net Pay <span class="float-right" id="payStubNetPay">$</span></p>

                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer" style="text-align:center;">
                                    <a href="javascript:viewPayStubDetail();">View Pay Stub Detail</a>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {

        loadMyNotificationWidgetDetail();

        $('#myNotificationPeriodType').on('change', function () {
            loadMyNotificationWidgetDetail();
        });



    });

    function loadMyNotificationWidgetDetail() {
        getDashboardMyNotificationWidgetDetail();
        // getDashboardMyNotificationList(null);
        getDashboardMyScheduleWidgetDetail();
        getDashboardMyLicensesWidgetDetail();
        getDashboardPayStubWidgetBatchDD();
        $('#payStubBatchList').on('change', function () {
            debugger;
            var batchId = $(this).val();
            getDashboardPayStubWidgetData(batchId);
        });
    }

    function getDashboardMyNotificationWidgetDetail() {
        $("#divLoadingMyNotificationWidget").show();
        debugger;
        var parmObject = new Object();
        parmObject.UserRecordPeriodTypeId = $('#myNotificationPeriodType').val();
        parmObject.UserId = $('#UserId').val();
        $.ajax({
            type: "POST",
            url: '/UserInformation/GetDashboardMyNotificationRecordWidget',
            data: JSON.stringify(parmObject),

            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                //console.log(data);

                $("#divDashboardMyNotiRecord").html(data);
                $("#divLoadingMyNotificationWidget").hide();

            },
            error: function () {
                // displayWarningMessage(data.ErrorMessage);
            }
        });
    }
    function getDashboardMyNotificationList(statusTypeId) {
        $("#divLoadingMyNotificationList").show();
        debugger;
        var parmObject = new Object();
        parmObject.UserRecordPeriodTypeId = $('#myNotificationPeriodType').val();
        parmObject.UserRecordStatusTypeId = statusTypeId;
        parmObject.UserId = $('#UserId').val();
        $("#divDashboardNotificationsList").html("");
        $("#notificationList_modal").modal("show");
        $('#NotificationTypeName').text("My Notification(s) List");
        $("#divLoadingNotificationList").show();
        $.ajax({
            type: "POST",
            url: '/UserInformation/GetDashboardMyNotificationList',
            data: JSON.stringify(parmObject),

            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                //console.log(data);
                //if (statusTypeId != null) {
                //    $('html, body').animate({
                //        scrollTop: ($('#divDashboardMyNotificationList').offset().top)
                //    }, 500);
                //}

                //$("#divDashboardMyNotificationList").html(data);
                //$("#divLoadingMyNotificationList").hide();
                $("#divDashboardNotificationsList").html(data);
                $("#divLoadingNotificationList").hide();
                $('#tblNotification').dataTable({
                    "searching": true,
                    "paging": true,
                    "pageLength": 5,
                    "lengthChange": false
                });
            },
            error: function () {
                // displayWarningMessage(data.ErrorMessage);
            }
        });
    }
    function getDashboardMyScheduleWidgetDetail() {
        debugger;
        if ($("#IsTimeAideWindowClient").val() == "False") return;
        $("#divLoadingCurrentSchedule").show();

        $.ajax({
            type: "POST",
            url: '/EmployeeAttendanceSchedule/GetDashboardMyCurrentScheduleWidget',
            data: { id: $('#UserId').val() },
            dataType: "json",
            success: function (data) {
                debugger;
                //console.log(data);
                if (data.status == "Success") {
                    $("#spanScheduleDateRange").text(data.widgetData.sNote);
                    $("#spanWorkingDays").text(data.widgetData.nPayWeekNum);
                    $("#spanTotalHours").text(data.widgetData.dblPeriodHours);
                }
                else {
                    showAlertAutoHide("", "Error", data.message);
                }
                $("#divLoadingCurrentSchedule").hide();

            },
            error: function () {
                // displayWarningMessage(data.ErrorMessage);
            }
        });
    }
    function getDashboardMyLicensesWidgetDetail() {
        debugger;
        if ($("#IsTimeAideWindowClient").val() == "False") return;
        $("#divLoadingMyLicensesList").show();

        $.ajax({
            type: "GET",
            url: '/EmployeeLicenses/GetDashboardMyCurrentLicensesWidget',
            data: { id: $('#UserId').val() },
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                $("#divDashboardMyLicensesList").html(data);
                $("#divLoadingMyLicensesList").hide();
            },
            error: function () {
                // displayWarningMessage(data.ErrorMessage);
            }
        });
    }
    function getDashboardPayStubWidgetBatchDD() {
        debugger;
        if ($("#IsTimeAideWindowClient").val() == "False") return;
        $("#divLoadingPayStubWidget").show();

        $.ajax({
            type: "POST",
            url: '/EmployeePayStub/AjaxPayStubBatchList',
            dataType: "json",
            data: { "id": $('#UserId').val() },
            success: function (data) {
                debugger;
                $("#divLoadingPayStubWidget").hide();
                //console.log(data);
                if (data.status == "Success") {
                    debugger;
                    var isFirstRecordSel = false;
                    var selectedBatchId = "";
                    console.log(data.widgetData);
                    $('#payStubBatchList option').remove();
                    $(data.widgetData).each(function () {
                        debugger;
                        if (isFirstRecordSel == false) {
                            selectedBatchId = this.BatchId;
                            isFirstRecordSel = true;
                        }
                        var option = '<option value=' + this.BatchId + '>' + this.BatchDescription + '</option>';
                        $('#payStubBatchList').append(option);
                    });

                    if (isFirstRecordSel) {
                        getDashboardPayStubWidgetData(selectedBatchId);
                    }
                }
                else {
                    showAlertAutoHide("", "Error", data.message);
                }
                $("#divLoadingCurrentSchedule").hide();

            },
            error: function () {
                // displayWarningMessage(data.ErrorMessage);
            }
        });

    }
    function getDashboardPayStubWidgetData(batchId) {
        debugger;
        if ($("#IsTimeAideWindowClient").val() == "False") return;
        // $("#divLoadingCurrentSchedule").show();

        $.ajax({
            type: "POST",
            url: '/EmployeePayStub/AjaxDashboardPayStubWidgetData',
            data: {
                "batchId": batchId,
                "id": $('#UserId').val()
            },
            dataType: "json",
            success: function (data) {
                debugger;
                //console.log(data);
                if (data.status == "Success") {
                    debugger;
                    console.log(data.widgetData);
                    $("#payStubBatchName").text(data.widgetData.BatchDescription);
                    $("#payStubPayDate").text(data.widgetData.PayDate);
                    //$("#payStubStartDate").text(data.widgetData.PeriodStart);
                    //$("#payStubEndDate").text(data.widgetData.PeriodEnd);
                    $("#payStubPayPeriod").text(data.widgetData.PeriodStart + " - " + data.widgetData.PeriodEnd);
                    $("#payStubEarning").text("$" + data.widgetData.Earnings);
                    $("#payStubDeduction").text("$" + data.widgetData.Deducations);
                    $("#payStubNetPay").text("$" + data.widgetData.NetPayAmount);
                }
                else {
                    showAlertAutoHide("", "Error", data.message);
                }
                $("#divLoadingCurrentSchedule").hide();

            },
            error: function () {
                // displayWarningMessage(data.ErrorMessage);
            }
        });

    }
    function viewCurrentScheduleDetail(useId) {
        window.location.href = "/EmployeeAttendanceSchedule/SelfServiceSchedule";
    }
    function viewTimeOffDetail() {
        var userId = $('#UserId').val();
        window.location.href = "/EmployeeTimeOffRequest/IndexByEmployee?id=" + userId;
    }
    function viewPayStubDetail() {
        debugger;
        var batchId = $("#payStubBatchList").val();
        if (batchId == "" || batchId == null) {
            showAlertAutoHide("", "Error", "Please select the Pay Stub period.");
            return;
        }
        var userId = $('#UserId').val();
        window.location.href = "/EmployeePayStub/Index?batchId=" + batchId + "&id=" + userId;
    }

</script>
