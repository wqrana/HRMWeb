
@{
    ViewBag.Title = "Schedule";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@*<link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />*@
<!-- Page Header -->
<div class="page-header">
    <div class="row align-items-center">
        <div class="col-sm-12">
            <h3 class="page-title">Schedule</h3>
            <ul class="breadcrumb">
                <li class="breadcrumb-item">Attendance</li>
                <li class="breadcrumb-item active">Schedule</li>

            </ul>
            <div class="alert" style="display:none;" id="applicantIndexPageAlert">
                <a href="javascript:void(0)" class="close" id="alertDismiss">&times;</a>
                <strong>Alert!</strong><span></span>
            </div>
        </div>

    </div>
</div>
@{Html.RenderAction("GetScheduleFilters", "EmployeeAttendanceSchedule");}
@*<div class="row filter-row">
    <div class="col-sm-2 col-md-2 pr-0">
        <div class="form-group form-focus mb-1">
            <input id="ScheduleDate" type="datetime" class="form-control floating" value="@DateTime.Today">
            <label class="focus-label">From/To Date</label>
        </div>
    </div>
    <div class="col-sm-2 col-md-2 pr-0 pl-0">
        <div class="form-group form-focus mb-1">
            <input id="EmployeeId" type="text" class="form-control floating">
            <label class="focus-label">Employee ID</label>
        </div>
    </div>
    <div class="col-sm-6 col-md-3 pl-0 pr-0">
        <div class="form-group form-focus mb-1">
            <input id="EmployeeName" type="text" class="form-control floating">
            <label class="focus-label">Employee Name</label>
        </div>
    </div>
    <div class="col-sm-3 col-md-3 pl-0 pr-0">
        <div class="form-group form-focus select-focus mb-1">
            @Html.DropDownList("DepartmentId", null, "All", new { @class = "select floating" })
            <label class="focus-label">Department</label>
        </div>
    </div>
    <div class="col-sm-3 col-md-3 pr-0">
        <div class="form-group form-focus select-focus mb-1">
            @Html.DropDownList("SubDepartmentId", null, "All", new { @class = "select floating" })
            <label class="focus-label">SubDepartment</label>
        </div>
    </div>
    <div class="col-sm-3 col-md-3 pl-0 pr-0">
        <div class="form-group form-focus select-focus mb-1">
            @Html.DropDownList("EmployeeTypeId", null, "All", new { @class = "select floating" })
            <label class="focus-label">Employee Type</label>
        </div>
    </div>
    <div class="col-sm-3 col-md-3 pl-0 pr-0">
        <div class="form-group form-focus select-focus mb-1">
            @Html.DropDownList("PositionId", null, "All", new { @class = "select floating" })
            <label class="focus-label">Position</label>
        </div>
    </div>
    <div class="col-sm-1 col-md-1 pl-0 pr-0">
        <a href="javascript: getAttendanceScheduleList();" class="btn btn-success btn-block"> Search </a>
    </div>

</div>*@

<div class="row pb-0 mb-0">
    <div class="col-sm-10">
    </div>
    <div class="col-sm-2 pr-0">
        <div class="col-auto float-right ml-auto pr-0">
            <div class="btn-group btn-group-sm pb-1">
                @*<button class="btn btn-white">PDF</button>*@
                <button class="btn btn-white" onclick="javascript:runLocalReport(0)"><i class="fa fa-print fa-lg"></i> Print</button>
            </div>
        </div>
    </div>
</div>
<div style="padding:5px; padding-top:0px;">
    <div style="font-size: 90%;">
        <div class="form-group row mb-0">
            <div id="divLoadingScheduleList" class="align-content-md-center">
                <img src="~/Content/Themes/assets/img/ajax-loading.gif" width="24" height="24" />
            </div>
            <div class="panel panel-default" style="width:100%;margin-left:5px">
                <div class="panel-heading" style="padding-left:10px">
                    Schedule
                    @*<div class="pull-right dropdown-action" style="height:20px;" id="contactInfoMenu">
                            <a href="#" class="action-icon dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="material-icons">more_horiz</i></a>
                            <div class="dropdown-menu dropdown-menu-right" x-placement="bottom-end" style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(38px, 32px, 0px);">
                                <a a href="javascript:AddEditContactInfo();" class="dropdown-item"><i class="fa fa-pencil m-r-5"> Edit</i></a>
                            </div>
                        </div>*@
                </div>
                <div class="panel-body">
                    <div id="divScheduleList" style="max-height:450px; overflow-y:auto">
                        Fetch Schedule
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group row mb-0">
            <div id="divLoadingScheduleDetail" class="align-content-md-center">
                <img src="~/Content/Themes/assets/img/ajax-loading.gif" width="24" height="24" />
            </div>
            <div class="panel panel-default" style="width:100%;margin-left:5px">
                <div class="panel-heading" style="padding-left:10px">
                    Schedule Detail
                    @*<div class="pull-right dropdown-action" style="height:20px;" id="contactAddressMenu">
                            <a href="#" class="action-icon dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="material-icons">more_horiz</i></a>
                            <div class="dropdown-menu dropdown-menu-right" x-placement="bottom-end" style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(38px, 32px, 0px);">
                                <a a href="javascript:AddEditAddressInfo(0);" class="dropdown-item"><i class="fa fa-pencil m-r-5"> Edit</i></a>
                            </div>
                        </div>*@

                </div>

                <div class="panel-body">
                    <div id="divScheduleDetail" @*style="max-height:160px; overflow-y:auto"*@>
                        No Schedule Selected
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="divEditScheduleDetail">

</div>
@*<script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>*@
<script>
    //JS for Applicant main page
    var alertID = null;
    $(document).ready(function () {
        debugger;
        //Default User List on list view
        $("#divLoadingScheduleList").hide();
        $("#divLoadingScheduleDetail").hide();
        //$('#ScheduleDate').datetimepicker({
        //    uiLibrary: 'bootstrap4',
        //    modal: false,
        //    footer: true,
        //    format: 'dd/mm/yyyy hh:mm tt',
        //    size: 'small'
        //});
        $('#pickDateTime').datetimepicker({
            format: "DD/MM/YYYY hh:mm A"
        });
        //var schDate = jquery1_10_2('#ScheduleDate').val();
        //$('input[name="viewSchedule"]:radio').change(function () {
        //    debugger;
        //    var selectedSch = $("input[name='viewSchedule']:checked");
        //    var id=($(selectedSch).attr("id"));
        //    var val= ($(selectedSch).val());
        //});


    });

    function getAttendanceSchedules() {
        $("#divLoadingScheduleList").show();
        debugger;
        var filterObject = new Object();

        filterObject.ScheduleDate = $('#ScheduleDate').val();
        filterObject.EmployeeId = $('#EmployeeId').val();
        filterObject.EmployeeName = $('#EmployeeName').val();
        filterObject.PositionId = $('#PositionId').val();
        filterObject.DepartmentId = $('#DepartmentId').val();

        filterObject.SubDepartmentId = $('#SubDepartmentId').val();
        filterObject.EmployeeTYpeId = $('#EmployeeTypeId').val();

        $.ajax({
            type: "POST",
            url: '/EmployeeAttendanceSchedule/GetAttendanceSchedule',
            data: JSON.stringify(filterObject),

            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                $("#divScheduleList").html(data);
                $("#divScheduleDetail").text("No Schedule Selected");
                $("#divLoadingScheduleList").hide();
            },
            error: function () {
                // displayWarningMessage(data.ErrorMessage);
            }
        });
    }
    // getAttendanceScheduleDetail
    function getAttendanceScheduleDetail(schId, companyId) {
        $("#divLoadingScheduleDetail").show();
        debugger;

        $.ajax({
            type: "GET",
            url: '/EmployeeAttendanceSchedule/GetAttendanceScheduleDetail',
            data: { "schId": schId, "companyId": companyId },
            success: function (data) {
                debugger;
                $("#divScheduleDetail").html(data);
                $("#divLoadingScheduleDetail").hide();
                $('html, body').animate({
                    scrollTop: ($('#divScheduleDetail').offset().top)
                }, 500);
            },
            error: function () {
                // displayWarningMessage(data.ErrorMessage);
            }
        });
    }
    function getScheduleDetailEditData(schId, schDetailId, companyId) {
        debugger;
        $.ajax({
            type: "GET",
            url: '/EmployeeAttendanceSchedule/EditAttendenceScheduleDetail',
            data: { "schId": schId, "schDetailId": schDetailId, "companyId": companyId },
            success: function (data) {
                debugger;
                $("#divEditScheduleDetail").html(data);
                $("#editScheduleDetail_modal").modal("show");
            },
            error: function () {
                // displayWarningMessage(data.ErrorMessage);
            }
        });
    }
    //getScheduleEditData
    function getScheduleEditData(schId, companyId) {
        debugger;
        $.ajax({
            type: "GET",
            url: '/EmployeeAttendanceSchedule/EditAttendenceSchedule',
            data: { "schId": schId },
            success: function (data) {
                debugger;
                $("#divEditScheduleDetail").html(data);
                $("#editSchedule_modal").modal("show");
            },
            error: function () {
                // displayWarningMessage(data.ErrorMessage);
            }
        });
    }

    function runLocalReport(schId) {
        debugger;
        var dataObj = new Object();
        dataObj.ReportId = schId == 0 ? 28 : 27;
        dataObj.CriteriaType = 2; // 2 is used to run local report
        dataObj.AttendanceSchId = schId;
        dataObj.ScheduleDate = $('#ScheduleDate').val();
        dataObj.EmployeeSelectionIds = $('#SelectedScheduleIds').val();
        $.ajax({
            type: "POST",
            url: "/Reports/AdhocReportPopup",
            data: JSON.stringify(dataObj),
            contentType: "application/json; charset=utf-8",
            // dataType: "json",
            success: function (data) {
                debugger;
                //console.log(data);
                $("#divAdhocReportPopup").html(data);
                // setTimeout(function () { $('#divLoadingReport').hide(); }, 3000);
                $("#AdhocReportPopup_modal").modal('show');
            },
            error: function (request, status, error) {
                alert('Error in in runing  report data');
                return false;
            }
        });
    }


</script>
